<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>ERC-1155 Bond Mint Terminal</title>

    <!-- Bootstrap -->
    <link
        href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css"
        rel="stylesheet"
    />

    <!-- Ethers.js -->
    <script src="https://cdn.jsdelivr.net/npm/ethers@6.9.0/dist/ethers.umd.min.js"></script>

    <style>
        body {
            background-color: #0b0f0c;
            color: #33ff33;
            font-family: "Courier New", monospace;
        }

        .terminal {
            background-color: #050805;
            border: 1px solid #33ff33;
            border-radius: 6px;
            padding: 20px;
            box-shadow: 0 0 15px rgba(51, 255, 51, 0.2);
        }

        .terminal-header {
            color: #9eff9e;
            margin-bottom: 15px;
        }

        .btn-terminal {
            background-color: #0b0f0c;
            border: 1px solid #33ff33;
            color: #33ff33;
        }

        .btn-terminal:hover {
            background-color: #33ff33;
            color: #000;
        }

        .log {
            background-color: #020402;
            border: 1px solid #1d401d;
            padding: 10px;
            height: 160px;
            overflow-y: auto;
            font-size: 0.9rem;
        }

        .prompt::before {
            content: "$ ";
            color: #9eff9e;
        }
    </style>
</head>

<body>
<div class="container mt-5">
    <div class="terminal mx-auto col-md-8">
        <div class="terminal-header">
            <strong>ERC-1155 Bond Mint Terminal</strong><br>
            Network: Arbitrum Sepolia<br>
            Price: 0.0001 ETH
        </div>

        <div class="mb-3">
            <button id="connectBtn" class="btn btn-terminal w-100">
                Connect MetaMask
            </button>
        </div>

        <div class="mb-3">
            <button id="mintBtn" class="btn btn-terminal w-100" disabled>
                Mint Bond
            </button>
        </div>

        <div class="log" id="log"></div>
    </div>
</div>

<script>
    const CONTRACT_ADDRESS = "0xYOUR_CONTRACT_ADDRESS";
    const TOKEN_ID = 1;
    const MINT_PRICE = ethers.parseEther("0.0001");

    const ABI = [
        "function mint(address to, uint256 id, uint256 amount, bytes data) payable"
    ];

    let provider, signer, contract;

    const log = (msg) => {
        const logBox = document.getElementById("log");
        logBox.innerHTML += `<div class="prompt">${msg}</div>`;
        logBox.scrollTop = logBox.scrollHeight;
    };

    async function switchToArbSepolia() {
        const chainId = "0x66eee"; // 421614
        try {
            await window.ethereum.request({
                method: "wallet_switchEthereumChain",
                params: [{ chainId }]
            });
        } catch (err) {
            if (err.code === 4902) {
                await window.ethereum.request({
                    method: "wallet_addEthereumChain",
                    params: [{
                        chainId,
                        chainName: "Arbitrum Sepolia",
                        nativeCurrency: {
                            name: "ETH",
                            symbol: "ETH",
                            decimals: 18
                        },
                        rpcUrls: ["https://sepolia-rollup.arbitrum.io/rpc"],
                        blockExplorerUrls: ["https://sepolia.arbiscan.io"]
                    }]
                });
            } else {
                throw err;
            }
        }
    }

    document.getElementById("connectBtn").onclick = async () => {
        if (!window.ethereum) {
            alert("MetaMask not detected");
            return;
        }

        try {
            log("Connecting wallet...");
            await switchToArbSepolia();

            provider = new ethers.BrowserProvider(window.ethereum);
            signer = await provider.getSigner();
            const address = await signer.getAddress();

            contract = new ethers.Contract(CONTRACT_ADDRESS, ABI, signer);

            log(`Connected: ${address}`);
            document.getElementById("mintBtn").disabled = false;
        } catch (err) {
            console.error(err);
            log("Connection failed");
        }
    };

    document.getElementById("mintBtn").onclick = async () => {
        try {
            log("Sending mint transaction...");

            const tx = await contract.mint(
                await signer.getAddress(),
                TOKEN_ID,
                1,
                "0x",
                { value: MINT_PRICE }
            );

            log(`Tx sent: ${tx.hash}`);
            await tx.wait();
            log("Mint successful âœ”");
        } catch (err) {
            console.error(err);
            log("Mint failed");
        }
    };
</script>
</body>
</html>
